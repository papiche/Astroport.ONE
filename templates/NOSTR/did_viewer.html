<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/x-icon" href="/ipfs/QmQRq211EMmQJ7QE44FrVZt8EMF7JJWnayDXHyKzes4pX1">
    <title>UPlanet DID Document Viewer</title>
    <script src="/ipfs/QmQLQ5WdCEc7mpKw5rhUujUU1URKweei4Bb4esyVNd9Atx/G1PalPay_fichiers/jquery-3.6.3.min.js"></script>
    <style>
        /* Basic styles - matching nostr.html */
        body { 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            padding: 15px; 
            background-color: #1a1a1a; 
            color: #e0e0e0; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh; 
            box-sizing: border-box; 
        }
        .container { 
            background-color: #2a2a2a; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.5); 
            width: 100%; 
            max-width: 800px; 
            margin: 20px auto; 
            box-sizing: border-box; 
        }
        h1 { 
            background: linear-gradient(to right, #ff6b6b, #ffa500, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            font-size: 1.8em; 
            text-align: center; 
            margin-bottom: 20px; 
        }
        .warning {
            background: linear-gradient(to right, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
            color: #ffffff;
            border: 1px solid #ffcc00;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* DID-specific styles */
        .did-info {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .did-info h3 {
            color: #4CAF50;
            margin-top: 0;
            border-bottom: 1px solid #555;
            padding-bottom: 5px;
        }
        .did-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }
        .did-field:last-child {
            border-bottom: none;
        }
        .did-label {
            font-weight: bold;
            color: #cccccc;
            min-width: 120px;
        }
        .did-value {
            color: #e0e0e0;
            font-family: monospace;
            word-break: break-all;
            text-align: right;
            flex: 1;
            margin-left: 10px;
        }
        
        /* JSON display styles */
        .json-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            overflow-x: auto;
            background-color: #222;
            border-color: #555;
        }
        .json-display pre {
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* Status and loading */
        #status { 
            margin-top: 15px; 
            font-weight: bold; 
            text-align: center; 
            padding: 10px; 
            border-radius: 4px; 
            background-color: #333; 
            min-height: 20px; 
            color: #ccc; 
            word-wrap: break-word; 
        }
        .spinner { 
            display: none; 
            width: 40px; 
            height: 40px; 
            margin: 20px auto; 
            border: 4px solid #555; 
            border-top: 4px solid #4CAF50; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        
        /* Service and verification method cards */
        .service-card, .verification-card {
            background-color: #383838;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .service-card h4, .verification-card h4 {
            color: #4CAF50;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .service-field, .verification-field {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 3px 0;
        }
        .service-field .label, .verification-field .label {
            color: #aaa;
            font-weight: bold;
            min-width: 100px;
        }
        .service-field .value, .verification-field .value {
            color: #e0e0e0;
            font-family: monospace;
            word-break: break-all;
            text-align: right;
            flex: 1;
            margin-left: 10px;
        }
        
        /* Metadata section */
        .metadata-section {
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .metadata-section h4 {
            color: #2196F3;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        /* Responsive design */
        @media screen and (max-width: 480px) {
            .container {
                padding: 10px;
                margin: 10px auto;
            }
            .did-field {
                flex-direction: column;
                align-items: flex-start;
            }
            .did-value {
                text-align: left;
                margin-left: 0;
                margin-top: 5px;
            }
            .service-field, .verification-field {
                flex-direction: column;
                align-items: flex-start;
            }
            .service-field .value, .verification-field .value {
                text-align: left;
                margin-left: 0;
                margin-top: 3px;
            }
        }
        
        /* Details/summary styling */
        details { 
            background-color: #333; 
            padding: 5px; 
            border-radius: 4px; 
            margin-top: 15px;
        }
        details summary { 
            cursor: pointer; 
            color: #aaa; 
            font-size: 0.9em; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="warning">
            üîê UPlanet DID Document Viewer üîê
        </div>
        
        <h1 id="page-title">DID Document Viewer</h1>
        
        <div id="language-toggle" style="text-align: center; margin: 10px 0; display: none;">
            <button id="toggle-language-btn" style="background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                üåç International
            </button>
        </div>
        
        <div id="status">Loading DID document...</div>
        <div class="spinner" id="loadingSpinner"></div>
        
        <div id="content">
            <!-- Content will be populated by JavaScript -->
        </div>
        
        <details>
            <summary id="raw-json-summary">Show Raw JSON</summary>
            <div id="raw-json" class="json-display">
                <pre>Loading...</pre>
            </div>
        </details>
    </div>

    <script>
        // Global variables
        let didData = null;
        let userLanguage = 'fr'; // Default to French
        
        // IPFS URL for DID JSON data (will be replaced by sed)
        const _DID_JSON_URL_ = null;
        
        // Language detection and content
        function detectLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            const langCode = browserLang.split('-')[0].toLowerCase();
            
            // Check if it's French
            if (langCode === 'fr') {
                userLanguage = 'fr';
            } else {
                userLanguage = 'en';
            }
            
            console.log('Detected language:', userLanguage, 'from browser:', browserLang);
            
            // Update page elements
            updatePageElements();
            
            // Show language toggle for all users
            document.getElementById('language-toggle').style.display = 'block';
            
            // Set initial button text
            if (userLanguage === 'fr') {
                document.getElementById('toggle-language-btn').textContent = 'üåç International';
            } else {
                document.getElementById('toggle-language-btn').textContent = 'üá´üá∑ Fran√ßais';
            }
        }
        
        function updatePageElements() {
            document.getElementById('page-title').textContent = getText('title');
            document.getElementById('raw-json-summary').textContent = getText('rawJson');
        }
        
        function toggleLanguage() {
            if (userLanguage === 'fr') {
                userLanguage = 'en';
                document.getElementById('toggle-language-btn').textContent = 'üá´üá∑ Fran√ßais';
            } else {
                userLanguage = 'fr';
                document.getElementById('toggle-language-btn').textContent = 'üåç International';
            }
            
            updatePageElements();
            
            // Reload the DID content with new language
            if (didData) {
                displayDID(didData);
            }
        }
        
        // International content
        const content = {
            fr: {
                title: "DID Document Viewer",
                warning: "üîê UPlanet DID Document Viewer üîê",
                loading: "Chargement du document DID...",
                basicInfo: "üìã Informations de Base",
                verificationMethods: "üîë M√©thodes de V√©rification",
                services: "üåê Services",
                authentication: "üîê Authentification",
                metadata: "üìä M√©tadonn√©es UPlanet",
                franceConnect: "üá´üá∑ Statut France Connect",
                franceIdentite: "üÜî France Identit√© - Justificatif d'Identit√©",
                rawJson: "Afficher le JSON brut"
            },
            en: {
                title: "DID Document Viewer",
                warning: "üîê UPlanet DID Document Viewer üîê",
                loading: "Loading DID document...",
                basicInfo: "üìã Basic Information",
                verificationMethods: "üîë Verification Methods",
                services: "üåê Services",
                authentication: "üîê Authentication",
                metadata: "üìä UPlanet Metadata",
                franceConnect: "üá´üá∑ France Connect Status",
                rawJson: "Show Raw JSON"
            }
        };
        
        // Helper functions
        function log(message) {
            console.log(message);
        }
        
        function updateStatus(message, isError = false) {
            const el = $('#status');
            el.text(message);
            let bg = '#333', fg = '#ccc';
            if (isError) {
                bg = '#5c3a3a';
                fg = '#ff6b6b';
            }
            el.css({ 'background-color': bg, 'color': fg });
        }
        
        function getText(key) {
            return content[userLanguage][key] || content['en'][key];
        }
        
        function showLoading(show) {
            $('#loadingSpinner').toggle(show);
        }
        
        // Load DID document from IPFS URL
        async function loadDID() {
            try {
                showLoading(true);
                updateStatus(getText('loading'));
                
                // Get IPFS URL from the page
                const ipfsUrl = _DID_JSON_URL_;
                if (!ipfsUrl || ipfsUrl === 'null') {
                    throw new Error('No IPFS URL provided for DID document');
                }
                
                console.log('Loading DID from IPFS URL:', ipfsUrl);
                
                // Fetch DID document from IPFS
                const response = await fetch(ipfsUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const jsonText = await response.text();
                didData = JSON.parse(jsonText);
                
                displayDID(didData);
                updateStatus(userLanguage === 'fr' ? 'Document DID charg√© avec succ√®s depuis IPFS' : 'DID document loaded successfully from IPFS');
                
            } catch (error) {
                console.error('Error loading DID:', error);
                updateStatus(`Error loading DID document: ${error.message}`, true);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <strong>Error loading DID document:</strong><br>
                        ${error.message}<br><br>
                        <strong>IPFS URL:</strong> ${_DID_JSON_URL_ || 'Not provided'}
                    </div>
                `;
            } finally {
                showLoading(false);
            }
        }
        
        // Display DID information
        function displayDID(data) {
            const content = document.getElementById('content');
            
            let html = '<div class="did-info">';
            html += `<h3>${getText('basicInfo')}</h3>`;
            
            // DID ID
            if (data.id) {
                html += `
                    <div class="did-field">
                        <span class="did-label">DID ID:</span>
                        <span class="did-value">${data.id}</span>
                    </div>
                `;
            }
            
            // Context
            if (data['@context']) {
                const context = Array.isArray(data['@context']) ? data['@context'].join(', ') : data['@context'];
                html += `
                    <div class="did-field">
                        <span class="did-label">Context:</span>
                        <span class="did-value">${context}</span>
                    </div>
                `;
            }
            
            html += '</div>';
            
            // Verification Methods
            if (data.verificationMethod && data.verificationMethod.length > 0) {
                html += '<div class="verification-card">';
                html += `<h4>${getText('verificationMethods')}</h4>`;
                data.verificationMethod.forEach((method, index) => {
                    html += `
                        <div class="verification-field">
                            <span class="label">ID:</span>
                            <span class="value">${method.id || 'N/A'}</span>
                        </div>
                        <div class="verification-field">
                            <span class="label">Type:</span>
                            <span class="value">${method.type || 'N/A'}</span>
                        </div>
                        <div class="verification-field">
                            <span class="label">Controller:</span>
                            <span class="value">${method.controller || 'N/A'}</span>
                        </div>
                    `;
                    if (method.publicKeyMultibase) {
                        html += `
                            <div class="verification-field">
                                <span class="label">Public Key:</span>
                                <span class="value">${method.publicKeyMultibase}</span>
                            </div>
                        `;
                    }
                    if (index < data.verificationMethod.length - 1) {
                        html += '<hr style="border-color: #555; margin: 10px 0;">';
                    }
                });
                html += '</div>';
            }
            
            // Services
            if (data.service && data.service.length > 0) {
                html += '<div class="service-card">';
                html += `<h4>${getText('services')}</h4>`;
                data.service.forEach((service, index) => {
                    html += `
                        <div class="service-field">
                            <span class="label">ID:</span>
                            <span class="value">${service.id || 'N/A'}</span>
                        </div>
                        <div class="service-field">
                            <span class="label">Type:</span>
                            <span class="value">${service.type || 'N/A'}</span>
                        </div>
                        <div class="service-field">
                            <span class="label">Endpoint:</span>
                            <span class="value">${service.serviceEndpoint || 'N/A'}</span>
                        </div>
                    `;
                    if (index < data.service.length - 1) {
                        html += '<hr style="border-color: #555; margin: 10px 0;">';
                    }
                });
                html += '</div>';
            }
            
            // Authentication
            if (data.authentication && data.authentication.length > 0) {
                html += '<div class="did-info">';
                html += `<h3>${getText('authentication')}</h3>`;
                data.authentication.forEach(auth => {
                    html += `
                        <div class="did-field">
                            <span class="did-label">Method:</span>
                            <span class="did-value">${auth}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Metadata - Enhanced display for UPlanet-specific fields
            if (data.metadata) {
                html += '<div class="metadata-section">';
                html += `<h4>${getText('metadata')}</h4>`;
                
                // Contract Status (with color coding)
                if (data.metadata.contractStatus) {
                    const status = data.metadata.contractStatus;
                    let statusColor = '#4CAF50'; // Default green
                    let statusIcon = '‚úÖ';
                    
                    if (status.includes('rental')) {
                        statusColor = '#2196F3';
                        statusIcon = 'üè†';
                    } else if (status.includes('cooperative')) {
                        statusColor = '#FF9800';
                        statusIcon = 'üè¢';
                    } else if (status.includes('infrastructure')) {
                        statusColor = '#9C27B0';
                        statusIcon = 'üè≠';
                    } else if (status.includes('contributor')) {
                        statusColor = '#E91E63';
                        statusIcon = 'üí∞';
                    }
                    
                    html += `
                        <div class="did-field">
                            <span class="did-label">Contract Status:</span>
                            <span class="did-value" style="color: ${statusColor}; font-weight: bold;">
                                ${statusIcon} ${status}
                            </span>
                        </div>
                    `;
                }
                
                // Storage Quota
                if (data.metadata.storageQuota) {
                    html += `
                        <div class="did-field">
                            <span class="did-label">Storage Quota:</span>
                            <span class="did-value" style="color: #4CAF50; font-weight: bold;">${data.metadata.storageQuota}</span>
                        </div>
                    `;
                }
                
                // Services
                if (data.metadata.services) {
                    html += `
                        <div class="did-field">
                            <span class="did-label">Services:</span>
                            <span class="did-value">${data.metadata.services}</span>
                        </div>
                    `;
                }
                
                // Last Payment
                if (data.metadata.lastPayment) {
                    const payment = data.metadata.lastPayment;
                    html += `
                        <div class="did-field">
                            <span class="did-label">Last Payment:</span>
                            <span class="did-value" style="color: #4CAF50; font-weight: bold;">
                                ${payment.amount_zen} ·∫ê / ${payment.amount_g1} ƒû1
                            </span>
                        </div>
                        <div class="did-field">
                            <span class="did-label">Payment Date:</span>
                            <span class="did-value">${new Date(payment.date).toLocaleString()}</span>
                        </div>
                    `;
                }
                
                // WoT Duniter Member
                if (data.metadata.wotDuniterMember) {
                    const wot = data.metadata.wotDuniterMember;
                    html += `
                        <div class="did-field">
                            <span class="did-label">WoT Member:</span>
                            <span class="did-value" style="color: #FF9800; font-weight: bold;">${wot.g1pub}</span>
                        </div>
                        <div class="did-field">
                            <span class="did-label">Cesium Link:</span>
                            <span class="did-value">
                                <a href="${wot.cesiumLink}" target="_blank" style="color: #2196F3;">${wot.cesiumLink}</a>
                            </span>
                        </div>
                        <div class="did-field">
                            <span class="did-label">Verified At:</span>
                            <span class="did-value">${new Date(wot.verifiedAt).toLocaleString()}</span>
                        </div>
                    `;
                }
                
                // Astroport Station
                if (data.metadata.astroportStation) {
                    const station = data.metadata.astroportStation;
                    html += `
                        <div class="did-field">
                            <span class="did-label">Astroport Station:</span>
                            <span class="did-value" style="color: #9C27B0; font-weight: bold;">${station.ipns}</span>
                        </div>
                    `;
                }
                
                // Multipass Wallet
                if (data.metadata.multipassWallet) {
                    const wallet = data.metadata.multipassWallet;
                    html += `
                        <div class="did-field">
                            <span class="did-label">MULTIPASS Wallet:</span>
                            <span class="did-value" style="color: #4CAF50; font-weight: bold;">${wallet.g1pub}</span>
                        </div>
                        <div class="did-field">
                            <span class="did-label">Wallet Type:</span>
                            <span class="did-value">${wallet.type} - ${wallet.description}</span>
                        </div>
                    `;
                }
                
                // ZEN Card Wallet
                if (data.metadata.zencardWallet) {
                    const wallet = data.metadata.zencardWallet;
                    html += `
                        <div class="did-field">
                            <span class="did-label">ZEN Card Wallet:</span>
                            <span class="did-value" style="color: #2196F3; font-weight: bold;">${wallet.g1pub}</span>
                        </div>
                        <div class="did-field">
                            <span class="did-label">Wallet Type:</span>
                            <span class="did-value">${wallet.type} - ${wallet.description}</span>
                        </div>
                    `;
                }
                
                // France Connect Status - Enhanced display
                if (data.metadata.franceConnect) {
                    const fc = data.metadata.franceConnect;
                    html += '<div class="metadata-section">';
                    html += `<h4>${getText('franceConnect')}</h4>`;
                    
                    // Compliance Status with visual indicators
                    const complianceStatus = fc.compliance;
                    let complianceColor = '#dc3545'; // Red for disabled
                    let complianceIcon = '‚ùå';
                    let complianceText = 'Disabled';
                    
                    if (complianceStatus === 'enabled') {
                        complianceColor = '#28a745'; // Green for enabled
                        complianceIcon = '‚úÖ';
                        complianceText = 'Enabled';
                    }
                    
                    html += `
                        <div class="did-field">
                            <span class="did-label">Compliance:</span>
                            <span class="did-value" style="color: ${complianceColor}; font-weight: bold; font-size: 1.1em;">
                                ${complianceIcon} ${complianceText}
                            </span>
                        </div>
                    `;
                    
                    // KYC Status
                    if (fc.kycStatus) {
                        const kycStatus = fc.kycStatus;
                        let kycColor = '#ffc107'; // Yellow for pending
                        let kycIcon = '‚è≥';
                        let kycText = 'Pending';
                        
                        if (kycStatus === 'verified') {
                            kycColor = '#28a745'; // Green for verified
                            kycIcon = '‚úÖ';
                            kycText = 'Verified';
                        }
                        
                        html += `
                            <div class="did-field">
                                <span class="did-label">KYC Status:</span>
                                <span class="did-value" style="color: ${kycColor}; font-weight: bold;">
                                    ${kycIcon} ${kycText}
                                </span>
                            </div>
                        `;
                    }
                    
                    // WoT Verification
                    if (fc.wotVerification) {
                        const wotStatus = fc.wotVerification;
                        let wotColor = '#dc3545'; // Red for required
                        let wotIcon = '‚ùå';
                        let wotText = 'Required';
                        
                        if (wotStatus === 'completed') {
                            wotColor = '#28a745'; // Green for completed
                            wotIcon = '‚úÖ';
                            wotText = 'Completed';
                        }
                        
                        html += `
                            <div class="did-field">
                                <span class="did-label">WoT Verification:</span>
                                <span class="did-value" style="color: ${wotColor}; font-weight: bold;">
                                    ${wotIcon} ${wotText}
                                </span>
                            </div>
                        `;
                    }
                    
                    // Verification Level
                    if (fc.verificationLevel) {
                        const level = fc.verificationLevel;
                        let levelColor = '#6c757d'; // Gray for basic
                        let levelIcon = 'üîí';
                        
                        if (level === 'enhanced') {
                            levelColor = '#007bff'; // Blue for enhanced
                            levelIcon = 'üîì';
                        }
                        
                        html += `
                            <div class="did-field">
                                <span class="did-label">Verification Level:</span>
                                <span class="did-value" style="color: ${levelColor}; font-weight: bold;">
                                    ${levelIcon} ${level}
                                </span>
                            </div>
                        `;
                    }
                    
                    // Supported Services (only if enabled)
                    if (fc.compliance === 'enabled' && fc.supportedServices && fc.supportedServices.length > 0) {
                        html += `
                            <div class="did-field">
                                <span class="did-label">Supported Services:</span>
                                <span class="did-value">
                                    ${fc.supportedServices.map(service => {
                                        const serviceIcons = {
                                            'france-identite': 'üÜî',
                                            'ameli': 'üè•',
                                            'impots': 'üí∞',
                                            'caf': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                                            'pole-emploi': 'üíº'
                                        };
                                        const icon = serviceIcons[service] || 'üîó';
                                        return `${icon} ${service}`;
                                    }).join(', ')}
                                </span>
                            </div>
                        `;
                    } else if (fc.compliance === 'disabled') {
                        html += `
                            <div class="did-field">
                                <span class="did-label">Supported Services:</span>
                                <span class="did-value" style="color: #6c757d; font-style: italic;">
                                    None (KYC verification required)
                                </span>
                            </div>
                        `;
                    }
                    
                    // Data Sharing Policy
                    if (fc.dataSharing) {
                        const ds = fc.dataSharing;
                        html += `
                            <div class="did-field">
                                <span class="did-label">Data Sharing:</span>
                                <span class="did-value">
                                    Scope: ${ds.scope} | Retention: ${ds.retentionPeriod} | Consent: ${ds.consentRequired ? 'Required' : 'Not Required'}
                                </span>
                            </div>
                        `;
                    }
                    
                    // Certification Level
                    if (fc.certificationLevel) {
                        const certLevel = fc.certificationLevel;
                        let certColor = '#dc3545'; // Red for level 0
                        let certIcon = 'üîí';
                        
                        if (certLevel === 'level_2') {
                            certColor = '#28a745'; // Green for level 2
                            certIcon = 'üîì';
                        } else if (certLevel === 'level_1') {
                            certColor = '#ffc107'; // Yellow for level 1
                            certIcon = 'üîê';
                        }
                        
                        html += `
                            <div class="did-field">
                                <span class="did-label">Certification Level:</span>
                                <span class="did-value" style="color: ${certColor}; font-weight: bold;">
                                    ${certIcon} ${certLevel}
                                </span>
                            </div>
                        `;
                    }
                    
                    // Last Verification
                    if (fc.lastVerification) {
                        html += `
                            <div class="did-field">
                                <span class="did-label">Last Verification:</span>
                                <span class="did-value">${new Date(fc.lastVerification).toLocaleString()}</span>
                            </div>
                        `;
                    }
                    
                    // Process explanation based on status
                    if (fc.compliance === 'disabled') {
                        html += `
                            <div class="did-field" style="background-color: #2a2a2a; padding: 15px; border-radius: 5px; margin-top: 10px;">
                                <span class="did-label" style="color: #ffc107; font-weight: bold; font-size: 1.1em;">üìã Processus d'Activation:</span>
                                <div class="did-value" style="color: #e0e0e0; font-size: 0.9em; line-height: 1.6; margin-top: 10px;">
                                    <div style="display: flex; align-items: center; margin: 8px 0;">
                                        <span style="background: #007bff; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 0.8em;">1</span>
                                        <span><strong>Cr√©ation MULTIPASS</strong> (·∫êEN) - Identit√© de base UPlanet</span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 8px 0;">
                                        <span style="background: #6c757d; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 0.8em;">2</span>
                                        <span><strong>Cr√©ation ZEN Card</strong> (soci√©taire) - parts du capital</span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 8px 0;">
                                        <span style="background: #6c757d; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 0.8em;">3</span>
                                        <span><strong>Envoi justificatif Identit√©</strong> (KYC) au capitaine via <a href="https://france-identite.gouv.fr/justificatif/" target="_blank" style="color: #2196F3;">france-identite.gouv.fr</a></span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 8px 0;">
                                        <span style="background: #6c757d; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 0.8em;">4</span>
                                        <span><strong>Certification WoT 0.01ƒû1</strong> depuis compte forgeron Duniter (2nd transaction)</span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 8px 0;">
                                        <span style="background: #6c757d; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 0.8em;">5</span>
                                        <span><strong>UPLANET.official</strong> conversion <a href="https://opencollective.com/upanet-zero" target="_blank" style="color: #2196F3;">‚Ç¨ <-> ·∫êEN</a></span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 8px 0; padding: 10px; background: #1a3a1a; border-radius: 5px; border-left: 4px solid #28a745;">
                                        <span style="color: #28a745; font-size: 1.2em; margin-right: 10px;">üéâ</span>
                                        <span style="color: #28a745; font-weight: bold;">Bienvenue dans la coop√©rative !</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (fc.compliance === 'enabled') {
                        html += `
                            <div class="did-field" style="background-color: #1a3a1a; padding: 15px; border-radius: 5px; margin-top: 10px; border-left: 4px solid #28a745;">
                                <span class="did-label" style="color: #28a745; font-weight: bold; font-size: 1.1em;">‚úÖ France Connect Active:</span>
                                <div class="did-value" style="color: #e0e0e0; font-size: 0.9em; line-height: 1.6; margin-top: 10px;">
                                    <div style="display: flex; align-items: center; margin: 8px 0;">
                                        <span style="color: #28a745; font-size: 1.2em; margin-right: 10px;">üéâ</span>
                                        <span><strong>Bienvenue dans la coop√©rative !</strong></span>
                                    </div>
                                    <div style="margin-top: 10px; padding: 10px; background: #0d3a0d; border-radius: 5px;">
                                        Vous pouvez maintenant acc√©der aux services publics fran√ßais via France Connect en utilisant votre identit√© UPlanet. Votre statut de soci√©taire coop√©ratif est valid√© et votre contribution √† l'√©cosyst√®me UPlanet est enregistr√©e.
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                }
                
                
                
                // International section for non-French users
                if (userLanguage === 'en') {
                    html += '<div class="metadata-section">';
                    html += '<h4>üåç UPlanet International - Digital Sovereignty</h4>';
                    html += `
                        <div class="did-field" style="background-color: #1a1a2e; padding: 20px; border-radius: 5px; margin: 10px 0;">
                            <div style="color: #e0e0e0; font-size: 0.9em; line-height: 1.6;">
                                <div style="margin-bottom: 20px; text-align: center;">
                                    <h3 style="color: #2196F3; margin: 0 0 10px 0;">üåç Welcome to UPlanet Digital Sovereignty</h3>
                                    <p style="margin: 0; font-size: 1.1em; color: #4CAF50;">A decentralized identity and cooperative economy system</p>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                                    <div style="background: #2a2a2a; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #4CAF50;">
                                        <div style="color: #4CAF50; font-size: 2em; margin-bottom: 10px;">üîê</div>
                                        <div style="font-weight: bold; margin-bottom: 8px;">Decentralized Identity</div>
                                        <div style="font-size: 0.85em; color: #ccc;">Self-sovereign digital identity using W3C DID standards</div>
                                    </div>
                                    <div style="background: #2a2a2a; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #FF9800;">
                                        <div style="color: #FF9800; font-size: 2em; margin-bottom: 10px;">üí∞</div>
                                        <div style="font-weight: bold; margin-bottom: 8px;">Cooperative Economy</div>
                                        <div style="font-size: 0.85em; color: #ccc;">Democratic money and cooperative resource sharing</div>
                                    </div>
                                    <div style="background: #2a2a2a; padding: 15px; border-radius: 5px; text-align: center; border-left: 4px solid #9C27B0;">
                                        <div style="color: #9C27B0; font-size: 2em; margin-bottom: 10px;">üåê</div>
                                        <div style="font-weight: bold; margin-bottom: 8px;">Distributed Network</div>
                                        <div style="font-size: 0.85em; color: #ccc;">IPFS, Nostr, and blockchain integration</div>
                                    </div>
                                </div>
                                
                                <div style="margin: 20px 0; padding: 15px; background: #0d1a2e; border-radius: 5px; border-left: 4px solid #2196F3;">
                                    <div style="color: #2196F3; font-weight: bold; margin-bottom: 15px; font-size: 1.1em;">üöÄ Adapt UPlanet for Your Country</div>
                                    <div style="font-size: 0.9em; line-height: 1.6;">
                                        <p><strong>UPlanet is designed to be adapted to any country's legal and economic framework.</strong></p>
                                        <p>This French implementation includes France Connect integration, but the core system can be modified for:</p>
                                        <ul style="margin: 10px 0; padding-left: 20px;">
                                            <li><strong>Digital Identity:</strong> Integration with your country's digital identity system</li>
                                            <li><strong>Legal Compliance:</strong> Adaptation to local regulations and requirements</li>
                                            <li><strong>Economic Integration:</strong> Connection to national banking and payment systems</li>
                                            <li><strong>Language & Culture:</strong> Localization of interfaces and documentation</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div style="margin: 20px 0; padding: 15px; background: #1a3a1a; border-radius: 5px; border-left: 4px solid #28a745;">
                                    <div style="color: #28a745; font-weight: bold; margin-bottom: 10px;">üõ†Ô∏è Technical Implementation</div>
                                    <div style="font-size: 0.85em;">
                                        <p><strong>Core Technologies:</strong></p>
                                        <ul style="margin: 8px 0; padding-left: 20px;">
                                            <li><strong>DID:</strong> W3C Decentralized Identifiers (did:nostr:)</li>
                                            <li><strong>UCAN:</strong> User-Controlled Authorization Networks</li>
                                            <li><strong>SSSS:</strong> Shamir Secret Sharing (3/2 scheme)</li>
                                            <li><strong>Blockchain:</strong> Duniter/G1, Bitcoin, Monero integration</li>
                                            <li><strong>Storage:</strong> IPFS/IPNS decentralized storage</li>
                                            <li><strong>Social:</strong> Nostr protocol for decentralized communication</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div style="margin: 20px 0; padding: 15px; background: #2a1a1a; border-radius: 5px; border-left: 4px solid #E91E63;">
                                    <div style="color: #E91E63; font-weight: bold; margin-bottom: 10px;">ü§ù Join the UPlanet Community</div>
                                    <div style="font-size: 0.85em;">
                                        <p>UPlanet is an open-source project that welcomes contributions from developers worldwide.</p>
                                        <div style="margin-top: 10px;">
                                            <a href="https://github.com/UPlanet" target="_blank" style="background: #2196F3; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; font-weight: bold; margin-right: 10px;">
                                                üîó GitHub Repository
                                            </a>
                                            <a href="https://uplanet.org" target="_blank" style="background: #4CAF50; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; font-weight: bold;">
                                                üåê UPlanet Website
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="text-align: center; margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px;">
                                    <div style="color: #4CAF50; font-weight: bold; font-size: 1.1em; margin-bottom: 10px;">üåç Build Your Country's Digital Sovereignty</div>
                                    <div style="font-size: 0.9em; color: #ccc;">
                                        Adapt the Astroport.ONE codebase to create your own sovereign digital identity and cooperative economy system.
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    html += '</div>';
                }
                
                // Other metadata fields
                const standardFields = ['updated', 'created', 'version', 'email'];
                Object.entries(data.metadata).forEach(([key, value]) => {
                    if (!standardFields.includes(key) && 
                        !['contractStatus', 'storageQuota', 'services', 'lastPayment', 
                          'wotDuniterMember', 'astroportStation', 'multipassWallet', 'zencardWallet', 'franceConnect'].includes(key)) {
                        if (typeof value === 'object' && value !== null) {
                            html += `
                                <div class="did-field">
                                    <span class="did-label">${key}:</span>
                                    <span class="did-value">${JSON.stringify(value, null, 2)}</span>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="did-field">
                                    <span class="did-label">${key}:</span>
                                    <span class="did-value">${value}</span>
                                </div>
                            `;
                        }
                    }
                });
                
                html += '</div>';
            }
            
            content.innerHTML = html;
            
            // Update raw JSON display
            document.getElementById('raw-json').querySelector('pre').textContent = JSON.stringify(data, null, 2);
        }
        
        // Initialize when page loads
        $(document).ready(function() {
            log('DID Viewer initialized');
            detectLanguage();
            loadDID();
            
            // Add event listener for language toggle button
            document.getElementById('toggle-language-btn').addEventListener('click', toggleLanguage);
        });
    </script>
</body>
</html>
