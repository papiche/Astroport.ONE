# Fail2ban configuration for Duniter Docker container
# Bans IPs making more than 2 requests per 15 minutes for 24 hours
# Excludes legitimate G1 blockchain peers

[DEFAULT]
# Ban time: 24 hours (86400 seconds)
bantime = 86400
# Find time: 15 minutes (900 seconds)
findtime = 900
# Max retries: 2 requests
maxretry = 2
# Ban action
banaction = iptables-allports
# Unban action
unbanaction = iptables-allports-delete
# Ignore IPs from whitelist
ignoreip = 127.0.0.1/8 ::1

# Jail for Duniter BMA API (port 10901)
[duniter-bma]
enabled = true
port = 10901
filter = duniter
logpath = /var/lib/docker/containers/*/logs/*.log
maxretry = 2
findtime = 900
bantime = 86400
ignoreip = 127.0.0.1/8 ::1 172.20.0.0/16 172.17.0.0/16

# Jail for Duniter WS2P (port 20901)
[duniter-ws2p]
enabled = true
port = 20901
filter = duniter
logpath = /var/lib/docker/containers/*/logs/*.log
maxretry = 2
findtime = 900
bantime = 86400
ignoreip = 127.0.0.1/8 ::1 172.20.0.0/16 172.17.0.0/16

# Jail for Duniter GVA (port 30901)
[duniter-gva]
enabled = true
port = 30901
filter = duniter
logpath = /var/lib/docker/containers/*/logs/*.log
maxretry = 2
findtime = 900
bantime = 86400
ignoreip = 127.0.0.1/8 ::1 172.20.0.0/16 172.17.0.0/16

# Jail for Duniter Debug (port 9220)
[duniter-debug]
enabled = true
port = 9220
filter = duniter
logpath = /var/lib/docker/containers/*/logs/*.log
maxretry = 2
findtime = 900
bantime = 86400
ignoreip = 127.0.0.1/8 ::1 172.20.0.0/16 172.17.0.0/16 