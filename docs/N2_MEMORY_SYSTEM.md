# NÂ² Memory System - Collective Decision Making

## Overview

The NÂ² Memory System is a **decentralized learning mechanism** that enables collective decision-making across the Astroport.ONE constellation. It follows the principle:

> **"L'IA propose, l'Humain dispose"** (AI proposes, Human disposes)

Based on **Conway's Angel Game** (force 2 escapes demon), this system ensures that recommendations emerge from collective intelligence rather than central authority.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 NÂ² Memory Architecture                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚   todo.sh       â”‚  â† Entry point for all operations      â”‚
â”‚  â”‚   (Scheduler)   â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚           â”‚                                                  â”‚
â”‚           â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              NOSTR Events (kind 31910)                   â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚ AI Rec 1 â”‚ â”‚ AI Rec 2 â”‚ â”‚ Captain  â”‚ â”‚  Vote 1  â”‚    â”‚â”‚
â”‚  â”‚  â”‚ proposed â”‚ â”‚ accepted â”‚ â”‚  TODO    â”‚ â”‚  for #1  â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚  Key: ~/.zen/game/uplanet.G1.nostr                      â”‚â”‚
â”‚  â”‚  Relay: wss://relay.copylaradio.com                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚           â”‚                                                  â”‚
â”‚           â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              AI Learning (question.py)                   â”‚â”‚
â”‚  â”‚                                                          â”‚â”‚
â”‚  â”‚  - Sees past accepted recommendations                    â”‚â”‚
â”‚  â”‚  - Learns from rejected recommendations                  â”‚â”‚
â”‚  â”‚  - Improves future suggestions                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Event Types

### 1. AI Recommendation (`ai_recommendation`)

Generated by `todo.sh` when analyzing Git changes:

```json
{
  "type": "n2_todo",
  "version": "2.0",
  "id": "ai_20260107143025_1_a3f2b1",
  "content": "Add kind 30851 sync to backfill_constellation.sh",
  "status": "proposed",
  "rec_type": "ai_recommendation",
  "priority": "high",
  "station": "12D3KooWABC...",
  "captain": "captain@uplanet.org",
  "votes": 0,
  "created_at": "2026-01-07T14:30:25Z"
}
```

### 2. Captain TODO (`captain_todo`)

Manually added by station captains:

```json
{
  "type": "n2_todo",
  "version": "2.0",
  "id": "captain_20260107150000_8b2c4a",
  "content": "Integrate Radicle for decentralized code hosting",
  "status": "proposed",
  "rec_type": "captain_todo",
  "priority": "medium",
  "station": "12D3KooWDEF...",
  "captain": "developer@node2.org",
  "votes": 0,
  "created_at": "2026-01-07T15:00:00Z"
}
```

### 3. Vote (`vote`)

Cast by any station to increase priority:

```json
{
  "type": "n2_todo",
  "version": "2.0",
  "id": "vote_ai_20260107143025_1_a3f2b1_12D3KooWXYZ_20260107160000",
  "content": "Vote for ai_20260107143025_1_a3f2b1 by captain@node3.org",
  "status": "vote",
  "rec_type": "vote",
  "priority": "high",
  "station": "12D3KooWXYZ...",
  "captain": "captain@node3.org"
}
```

## NOSTR Tags

Each event uses these tags for filtering:

| Tag | Purpose | Example |
|-----|---------|---------|
| `d` | Unique identifier | `ai_20260107143025_1_a3f2b1` |
| `t` | Type filter | `n2-todo`, `ai_recommendation`, `captain_todo` |
| `status` | Current status | `proposed`, `accepted`, `rejected`, `done` |
| `priority` | Priority level | `high`, `medium`, `low` |
| `station` | Origin station | `12D3KooWABC...` |
| `captain` | Author email | `captain@uplanet.org` |
| `created` | Creation date | `20260107` |

## Status Lifecycle

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
                    â–¼                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ proposed â”‚â”€â”€â”€â–ºâ”‚ accepted â”‚â”€â”€â”€â–ºâ”‚   done   â”‚    â”‚ rejected â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                               â–²
     â”‚                                               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **proposed**: Initial state (AI or captain created)
- **accepted**: Human validated (will be implemented)
- **rejected**: Human refused (AI learns to avoid similar)
- **done**: Implemented (closes the loop)

## Commands Reference

### Analysis Commands

```bash
# Analyze since last execution (default)
./todo.sh

# Analyze last 24 hours
./todo.sh --day

# Analyze last 7 days
./todo.sh --week

# Skip interactive mode (batch/cron)
./todo.sh --no-interactive
```

### Memory Commands

```bash
# Add a captain TODO (human-written idea)
./todo.sh --add "Implement CRDT-based document sync with NextGraph"

# List pending recommendations
./todo.sh --list

# Show recent memory entries
./todo.sh --memory
```

### Decision Commands

```bash
# Accept a recommendation (human validates)
./todo.sh --accept ai_20260107143025_1_a3f2b1

# Reject a recommendation (human refuses)
./todo.sh --reject ai_20260107143025_2_c7d4e8

# Mark as implemented
./todo.sh --done ai_20260107143025_1_a3f2b1

# Vote for a recommendation (+1 priority)
./todo.sh --vote ai_20260107143025_1_a3f2b1
```

## Interactive Session Example

```
$ ./todo.sh --day

ğŸš€ GÃ©nÃ©ration de TODO.today.md (DerniÃ¨res 24h)
ğŸ® NÂ² Constellation Protocol (Conway's Angel Game - force 2)

ğŸ“Š RÃ©cupÃ©ration des modifications Git (DerniÃ¨res 24h)...
âœ… 5 commit(s) trouvÃ©(s), 12 fichier(s) modifiÃ©(s)

ğŸ“š RÃ©cupÃ©ration de la mÃ©moire NÂ²...
ğŸ¤– Analyse des modifications avec question.py...

âœ… TODO.today.md gÃ©nÃ©rÃ© avec succÃ¨s
ğŸ“„ Fichier: /home/fred/.zen/Astroport.ONE/TODO.today.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ SÃ‰LECTION DES RECOMMANDATIONS (Capitaine dÃ©cide)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¤ Stockage des recommandations IA en Ã©vÃ©nements NOSTR sÃ©parÃ©s...

  [1] ğŸ”´ Add kind 30851 to backfill | NOSTR | Economic aggregation
      ID: ai_20260107143025_1_a3f2b1

  [2] ğŸŸ¡ Implement DID expiration | DID | NIP-101 compliance
      ID: ai_20260107143025_2_c7d4e8

  [3] ğŸŸ¢ Optimize amisOfAmis.txt | IPFS | Local performance
      ID: ai_20260107143025_3_9b2a5f

Actions disponibles:
  a <num>  - Accepter la recommandation
  r <num>  - Rejeter la recommandation
  v <num>  - Voter pour cette recommandation
  s        - Tout sauter (skip)
  q        - Quitter

Votre choix [a/r/v/s/q + numÃ©ro]: a 1
âœ… Recommandation #1 acceptÃ©e
   â†’ AjoutÃ©e Ã  TODO.md

Votre choix [a/r/v/s/q + numÃ©ro]: v 2
ğŸ—³ï¸  Vote pour recommandation #2
âœ… Vote recorded
   From: captain@12D3KooW...
   For: ai_20260107143025_2_c7d4e8

Votre choix [a/r/v/s/q + numÃ©ro]: q
âœ“ Fin de la sÃ©lection
â„¹ï¸  Les recommandations non traitÃ©es restent disponibles avec --list
```

## Collective Decision Flow

```
Station 1 (Paris)        Station 2 (Toulouse)      Station 3 (Lyon)
     â”‚                        â”‚                         â”‚
     â”‚ ./todo.sh              â”‚ ./todo.sh               â”‚ ./todo.sh
     â”‚                        â”‚                         â”‚
     â–¼                        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI recs  â”‚            â”‚ AI recs  â”‚            â”‚ AI recs  â”‚
â”‚ proposed â”‚            â”‚ proposed â”‚            â”‚ proposed â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                       â”‚                       â”‚
     â”‚ accept #1             â”‚ vote #1               â”‚ vote #1
     â”‚ vote #2               â”‚ accept #1             â”‚ add captain TODO
     â”‚                       â”‚                       â”‚
     â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NOSTR Constellation                       â”‚
â”‚                                                             â”‚
â”‚  rec_1: votes=3, status=accepted  â† HIGHEST PRIORITY        â”‚
â”‚  rec_2: votes=1, status=proposed                            â”‚
â”‚  captain_todo: votes=0, status=proposed                     â”‚
â”‚                                                             â”‚
â”‚  â†’ Collective intelligence emerges from individual votes    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Configuration

### Required Files

| File | Purpose |
|------|---------|
| `~/.zen/game/uplanet.G1.nostr` | Shared constellation key |
| `~/.zen/game/todo_last_run.marker` | Tracks last execution |
| `~/.zen/Astroport.ONE/.env` | Environment variables |

### Environment Variables

```bash
# In ~/.zen/Astroport.ONE/.env

# Open Collective integration
OPENCOLLECTIVE_PERSONAL_TOKEN="your_token"
OPENCOLLECTIVE_SLUG="monnaie-libre"

# Captain identification
CAPTAINEMAIL="captain@yourstation.org"
```

## Integration with Other Systems

### Open Collective

TODOs are published to Open Collective as development updates:

```
./todo.sh --day
  â”œâ”€â”€ Generate TODO report
  â”œâ”€â”€ Interactive selection
  â”œâ”€â”€ Publish to NOSTR (captain wall)
  â””â”€â”€ Publish to Open Collective (development updates)
```

### Future Integrations

| System | Purpose | Status |
|--------|---------|--------|
| **Radicle** | Decentralized code hosting | Planned |
| **NextGraph** | CRDT-based document collaboration | Planned |

## AI Learning Context

The AI receives memory context in its prompt:

```markdown
## MÃ©moire NÂ² (apprentissage constellation)

### MÃ©moire NÂ² (dÃ©cisions passÃ©es de la constellation)

- [accepted] Add kind 30851 to backfill (station: 12D3KooWABC)
- [rejected] Refactor all RUNTIME scripts (station: 12D3KooWDEF)
- [done] Implement PAF burn mechanism (station: 12D3KooWABC)

_Les recommandations 'accepted' ont Ã©tÃ© validÃ©es par un humain, 
'rejected' ont Ã©tÃ© refusÃ©es._
```

This enables the AI to:
1. Suggest similar ideas to those accepted
2. Avoid patterns that were rejected
3. Build on completed work

## Technical Reference

### NOSTR Kind

```
Kind: 31910 (NÂ² Development Memory)
```

### Event Structure

```json
{
  "kind": 31910,
  "pubkey": "<uplanet.G1.nostr pubkey>",
  "created_at": 1736262625,
  "tags": [
    ["d", "ai_20260107143025_1_a3f2b1"],
    ["t", "n2-todo"],
    ["t", "ai_recommendation"],
    ["status", "proposed"],
    ["priority", "high"],
    ["station", "12D3KooWABC..."],
    ["captain", "captain@uplanet.org"],
    ["created", "20260107"]
  ],
  "content": "{\"type\":\"n2_todo\",\"version\":\"2.0\",...}",
  "sig": "<schnorr signature>"
}
```

### Query Examples

```bash
# Get all proposed recommendations
./tools/nostr_get_events.sh --kind 31910 --tag-status proposed

# Get recommendations by station
./tools/nostr_get_events.sh --kind 31910 --tag-station 12D3KooWABC

# Get high priority items
./tools/nostr_get_events.sh --kind 31910 --tag-priority high
```

## Related Documentation

- [NIP-101 NÂ² Constellation Sync](../../nostr-nips/101-n2-constellation-sync-extension.md)
- [ZEN Economy](./ZEN.ECONOMY.readme.md)
- [Oracle System](./ORACLE_SYSTEM.md)
- [ORE System](./ORE_SYSTEM.md)

---

*Documentation generated: 2026-01-07*  
*System version: 2.0*
