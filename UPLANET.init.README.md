# UPLANET.INIT.SH - Initialisation Infrastructure UPlanet ·∫êEN

## üìã Description

`UPLANET.init.sh` est le script **FONDAMENTAL** d'initialisation de l'infrastructure compl√®te UPlanet ·∫êEN. Il cr√©e et initialise tous les portefeuilles coop√©ratifs, op√©rationnels et de gouvernance n√©cessaires au fonctionnement de l'√©cosyst√®me, en respectant la source primale unique `UPLANETNAME_G1`.

## üéØ Objectifs

1. **Initialisation compl√®te** : Cr√©er tous les portefeuilles depuis la source primale unique
2. **S√©curit√© primale** : Garantir la tra√ßabilit√© et l'anti-intrusion
3. **Infrastructure op√©rationnelle** : NODE (Armateur) et CAPTAIN (MULTIPASS/ZEN Card)
4. **Gouvernance coop√©rative** : Portefeuilles de r√©partition 3x1/3 et fiscalit√©
5. **Compatibilit√© modes** : Fonctionnement ORIGIN (niveau X) et ·∫êEN (niveau Y)

## üèõÔ∏è Infrastructure Compl√®te Initialis√©e

Le script cr√©e et initialise l'infrastructure compl√®te UPlanet ·∫êEN :

### **üè¶ Portefeuilles Coop√©ratifs de Base**

| Portefeuille | Fichier Dunikey | R√¥le dans l'√âcosyst√®me |
|---------------|------------------|------------------------|
| **`UPLANETNAME_G1`** | `uplanet.G1.dunikey` | **Source primale principale** - R√©serve ƒû1 de l'√©cosyst√®me |
| **`UPLANETNAME`** | `uplanet.dunikey` | **Services locaux** - Gestion revenus MULTIPASS |
| **`UPLANETNAME_SOCIETY`** | `uplanet.SOCIETY.dunikey` | **Capital social** - √âmission parts sociales ZEN Cards |

### **üèõÔ∏è Portefeuilles de Gouvernance Coop√©rative (3x1/3)**

| Portefeuille | Fichier Dunikey | Allocation Coop√©rative |
|---------------|------------------|------------------------|
| **`UPLANETNAME_CASH`** | `uplanet.CASH.dunikey` | **Tr√©sorerie** (33.33% du surplus) |
| **`UPLANETNAME_RND`** | `uplanet.RnD.dunikey` | **R&D** (33.33% du surplus) |
| **`UPLANETNAME_ASSETS`** | `uplanet.ASSETS.dunikey` | **Actifs** (33.34% du surplus) |
| **`UPLANETNAME_IMPOT`** | `uplanet.IMPOT.dunikey` | **Fiscalit√©** (TVA + IS) |

### **‚öôÔ∏è Infrastructure Op√©rationnelle**

| Portefeuille | Fichier Dunikey | Fonction Op√©rationnelle |
|---------------|------------------|-------------------------|
| **`NODE`** | `secret.NODE.dunikey` | **Armateur** - Re√ßoit PAF et apport capital machine |
| **`CAPTAIN.MULTIPASS`** | `~/.zen/game/nostr/$CAPTAINEMAIL/.secret.dunikey` | **MULTIPASS Captain** - Services NOSTR (1·∫ê/semaine) |
| **`CAPTAIN.ZENCARD`** | `~/.zen/game/players/$CAPTAINEMAIL/secret.dunikey` | **ZEN Card Captain** - Parts sociales (valorisation machine) |

## üîß Fonctionnement

### 1. V√©rification des Pr√©requis
- Outils requis : `silkaj`, `jq`, `bc`, `G1check.sh`
- Portefeuille source disponible avec solde suffisant

### 2. Source Primale Unique : UPLANETNAME_G1

Le script utilise **exclusivement** `UPLANETNAME_G1` comme source primale pour garantir :

#### **üîê S√©curit√© et Tra√ßabilit√©**
- **Source unique** : Tous les portefeuilles proviennent de `UPLANETNAME_G1`
- **Cha√Æne primale** : Tra√ßabilit√© compl√®te des fonds
- **Anti-intrusion** : Protection contre les fonds non autoris√©s
- **Coh√©rence √©conomique** : Respect de la Constitution ·∫êEN

#### **üéØ Modes UPlanet Support√©s**

**üåç Mode ORIGIN (Niveau X) :**
- `UPLANETNAME = "EnfinLibre"` (fixe)
- Source primale : `EnfinLibre.G1`
- R√©seau IPFS public

**üè¥‚Äç‚ò†Ô∏è Mode ·∫êEN (Niveau Y) :**
- `UPLANETNAME = $(cat ~/.ipfs/swarm.key)` (dynamique)
- Source primale : `$(cat ~/.ipfs/swarm.key).G1`
- R√©seau IPFS priv√© avec swarm.key

#### **üìç D√©tection Automatique du Mode**
```bash
# Le script d√©tecte automatiquement le mode :
if [[ -f ~/.ipfs/swarm.key ]]; then
    UPLANETNAME=$(cat ~/.ipfs/swarm.key)  # Mode ·∫êEN
else
    UPLANETNAME="EnfinLibre"              # Mode ORIGIN
fi
```

### 3. Calcul de la Capacit√© d'Initialisation
- **Solde minimum** : 1 ƒû1 requis pour commencer
- **Limite maximale** : 5 portefeuilles (1 ƒû1 chacun)
- **Initialisation partielle** : Si le solde est insuffisant, le script initialise le maximum possible

### 4. V√©rification des Portefeuilles
- Utilise `G1check.sh` pour v√©rifier les soldes
- Identifie les portefeuilles vides (< 0.01 ƒû1)
- Calcule le montant total requis

### 5. Initialisation
- Transf√®re 1 ƒû1 vers chaque portefeuille vide
- Attend la confirmation blockchain entre chaque transaction
- Limite le nombre de portefeuilles initialis√©s selon le solde disponible

## üìñ Utilisation

### Options Disponibles

```bash
./UPLANET.init.sh [OPTIONS]
```

| Option | Description |
|--------|-------------|
| `--dry-run` | Mode simulation (aucune transaction) |
| `--force` | Initialisation sans confirmation |
| `--help` | Affiche l'aide |

### Exemples d'Utilisation

#### Mode Simulation (Recommand√©)
```bash
./UPLANET.init.sh --dry-run
```
Affiche ce qui serait fait sans effectuer de transactions.

#### Initialisation Compl√®te
```bash
./UPLANET.init.sh
```
Lance l'initialisation avec confirmation interactive.

#### Initialisation Forc√©e
```bash
./UPLANET.init.sh --force
```
Lance l'initialisation sans demander de confirmation.

## üîç Mode Simulation

Le mode `--dry-run` permet de :
- V√©rifier l'√©tat actuel des portefeuilles
- Identifier les portefeuilles n√©cessitant une initialisation
- Calculer le montant total requis
- Simuler le processus sans risque

## ‚ö†Ô∏è Limitations et Contraintes

### Solde Minimum
- **Requis** : 1 ƒû1 minimum pour commencer
- **Recommand√©** : 5 ƒû1 pour initialiser tous les portefeuilles

### Initialisation Partielle
Si le solde est insuffisant :
- Le script initialise le maximum possible
- Affiche un avertissement d'initialisation partielle
- Permet de compl√©ter l'initialisation ult√©rieurement

### S√©curit√©
- V√©rification de l'existence des fichiers dunikey
- Validation des cl√©s publiques
- Confirmation interactive (sauf avec `--force`)

## üìä Sortie et Rapports

### Informations Affich√©es
- **√âtat des pr√©requis** : Outils disponibles
- **Portefeuille source** : Fichier et solde
- **Portefeuilles coop√©ratifs** : Statut et soldes
- **Plan d'initialisation** : Nombre et montants
- **R√©sum√© final** : Succ√®s et √©checs

### Codes de Sortie
- **0** : Succ√®s
- **1** : Erreur (pr√©requis, solde insuffisant, etc.)

## üöÄ Cas d'Usage Typiques

### 1. Premi√®re Installation
```bash
# V√©rifier l'√©tat initial
./UPLANET.init.sh --dry-run

# Initialiser si n√©cessaire
./UPLANET.init.sh
```

### 2. Maintenance R√©guli√®re
```bash
# V√©rifier p√©riodiquement
./UPLANET.init.sh --dry-run

# R√©initialiser si des portefeuilles sont vides
./UPLANET.init.sh
```

### 3. R√©cup√©ration Post-Erreur
```bash
# Identifier les probl√®mes
./UPLANET.init.sh --dry-run

# Forcer la r√©initialisation
./UPLANET.init.sh --force
```

---

## üîó **INT√âGRATION AVEC L'√âCOSYST√àME UPLANET ·∫êEN**

### **üöÄ Flux d'Embarquement**
```
install.sh ‚Üí uplanet_onboarding.sh ‚Üí UPLANET.init.sh ‚Üí captain.sh
     ‚Üì              ‚Üì                      ‚Üì              ‚Üì
Installation ‚Üí Configuration ‚Üí Initialisation ‚Üí Identit√© Capitaine
```

### **üèõÔ∏è Scripts √âconomiques Associ√©s**

| Script | R√¥le | Relation avec UPLANET.init.sh |
|--------|------|-------------------------------|
| **`UPLANET.official.sh`** | Virements officiels | Utilise les portefeuilles initialis√©s |
| **`ZEN.ECONOMY.sh`** | Paiement PAF + Burn | Utilise NODE et portefeuilles coop√©ratifs |
| **`ZEN.COOPERATIVE.3x1-3.sh`** | Allocation 3x1/3 | Utilise CASH, RND, ASSETS |
| **`NOSTRCARD.refresh.sh`** | Collecte MULTIPASS | Utilise UPLANETNAME et IMPOT |
| **`PLAYER.refresh.sh`** | Collecte ZEN Cards | Utilise UPLANETNAME_SOCIETY et IMPOT |

### **üîß Scripts de Configuration**

| Script | R√¥le | Int√©gration |
|--------|------|-------------|
| **`uplanet_onboarding.sh`** | Embarquement complet | Lance UPLANET.init.sh automatiquement |
| **`update_config.sh`** | Migration et mise √† jour | Peut relancer UPLANET.init.sh si n√©cessaire |
| **`heartbox_analysis.sh`** | Analyse syst√®me | Fournit les capacit√©s pour la valorisation |

### **üõ°Ô∏è S√©curit√© et Contr√¥le**

| Script | R√¥le | Protection Assur√©e |
|--------|------|-------------------|
| **`primal_wallet_control.sh`** | Anti-intrusion | Prot√®ge tous les portefeuilles initialis√©s |
| **`nostr_DESTROY_TW.sh`** | D√©sinscription MULTIPASS | Utilis√© lors des migrations ORIGIN ‚Üí ·∫êEN |
| **`PLAYER.unplug.sh`** | D√©sinscription ZEN Card | Utilis√© lors des migrations ORIGIN ‚Üí ·∫êEN |

---

## üéØ **WORKFLOW COMPLET D'INITIALISATION**

### **üÜï Nouveau Capitaine (Installation Fra√Æche)**
1. **`install.sh`** : Installation Astroport.ONE
2. **`uplanet_onboarding.sh`** : Configuration et choix du mode
3. **`UPLANET.init.sh`** : **Initialisation automatique** de l'infrastructure
4. **`captain.sh`** : Cr√©ation identit√© capitaine

### **üîÑ Migration ORIGIN ‚Üí ·∫êEN**
1. **`update_config.sh`** : D√©tection mode et migration
2. **D√©sinscription automatique** : `nostr_DESTROY_TW.sh` + `PLAYER.unplug.sh`
3. **`UPLANET.init.sh`** : **R√©initialisation** avec nouvelle source primale ·∫êEN
4. **`uplanet_onboarding.sh`** : Configuration ·∫êEN compl√®te

### **üîç Maintenance et V√©rification**
1. **`UPLANET.init.sh --dry-run`** : V√©rification √©tat des portefeuilles
2. **`heartbox_analysis.sh`** : Analyse capacit√©s syst√®me
3. **`zen.sh`** : Diagnostic √©conomique complet
4. **`dashboard.sh`** : Monitoring quotidien

---

## üìö **DOCUMENTATION CONNEXE**

### **üìñ Guides Principaux**
- **[EMBARQUEMENT.md](EMBARQUEMENT.md)** : Guide complet d'embarquement UPlanet ·∫êEN
- **[SCRIPTS.ROLES.md](SCRIPTS.ROLES.md)** : R√¥les de tous les scripts de l'√©cosyst√®me

### **üèõÔ∏è Constitution √âconomique**
- **[RUNTIME/ZEN.ECONOMY.readme.md](RUNTIME/ZEN.ECONOMY.readme.md)** : Constitution √©conomique compl√®te
- **[RUNTIME/ZEN.INTRUSION.POLICY.md](RUNTIME/ZEN.INTRUSION.POLICY.md)** : Politique anti-intrusion

### **üîß Configuration**
- **[.env.template](.env.template)** : Template de configuration avec toutes les variables
- **Configuration dynamique** via `heartbox_analysis.sh`

**Note de coh√©rence** : Les noms des fichiers dunikey sont **identiques** √† ceux utilis√©s dans tous les scripts √©conomiques (`ZEN.ECONOMY.sh`, `ZEN.COOPERATIVE.3x1-3.sh`, etc.), garantissant une **parfaite coh√©rence** dans l'√©cosyst√®me UPlanet ·∫êEN.

## üõ†Ô∏è D√©pannage

### Probl√®mes Courants

#### Portefeuille Source Non Trouv√©
```bash
‚ùå Aucun portefeuille source trouv√©
```
**Solution** : Cr√©er un fichier dunikey dans `~/.zen/game/`

#### Solde Insuffisant
```bash
‚ùå Solde insuffisant pour l'initialisation
```
**Solution** : Alimenter le portefeuille source avec au moins 1 ƒû1

#### Erreur de Cl√©
```bash
‚ùå Erreur cl√©
```
**Solution** : V√©rifier le format du fichier dunikey

### V√©rifications
```bash
# V√©rifier les fichiers dunikey
ls -la ~/.zen/game/*.dunikey

# V√©rifier les soldes
./tools/G1check.sh <PUBKEY>

# Tester le mode simulation
./UPLANET.init.sh --dry-run
```

## üìù Notes Techniques

### Format des Fichiers Dunikey
- Contiennent cl√© priv√©e et publique
- Format : `priv: <cl√©_priv√©e> pub: <cl√©_publique>`
- Permissions recommand√©es : 600
- **Coh√©rence** : Les noms des fichiers correspondent exactement √† ceux utilis√©s dans `ZEN.COOPERATIVE.3x1-3.sh`

### Calculs de Solde
- Utilise `G1check.sh` pour la pr√©cision
- Tol√©rance de 0.01 ƒû1 pour les comparaisons
- Conversion automatique ƒû1 ‚Üî ·∫êen (1:10 apr√®s transaction primale)

### S√©curit√© des Transactions
- V√©rification blockchain avant confirmation
- Pause entre transactions pour √©viter la surcharge
- Gestion des erreurs et rollback si n√©cessaire

## ü§ù Contribution et Support

### Signaler un Probl√®me
- V√©rifier d'abord avec `--dry-run`
- Consulter les logs d'erreur
- Tester avec un solde suffisant

### Am√©liorations Sugg√©r√©es
- Support de multiples portefeuilles sources
- Configuration des montants d'initialisation
- Int√©gration avec le monitoring automatique

---

## üéØ **R√âSUM√â EX√âCUTIF**

`UPLANET.init.sh` est le **script fondamental** qui transforme une installation Astroport.ONE en infrastructure UPlanet ·∫êEN compl√®te. Il :

1. **üîê Garantit la s√©curit√©** via la source primale unique `UPLANETNAME_G1`
2. **üèõÔ∏è Cr√©e l'infrastructure** compl√®te (8 portefeuilles + NODE + CAPTAIN)
3. **üéØ S'adapte automatiquement** au mode choisi (ORIGIN ou ·∫êEN)
4. **üîÑ Int√®gre parfaitement** avec tous les scripts √©conomiques
5. **üõ°Ô∏è Assure la coh√©rence** de l'√©cosyst√®me coop√©ratif

**Usage recommand√©** : Laisser `uplanet_onboarding.sh` l'ex√©cuter automatiquement lors de l'embarquement, ou utiliser `--dry-run` pour v√©rifier l'√©tat des portefeuilles.

---

**Version** : 2.0 (Architecture ORIGIN/·∫êEN)  
**Derni√®re mise √† jour** : D√©cembre 2024  
**Auteur** : √âquipe UPlanet ·∫êEN  
**Licence** : Conforme √† LEGAL.md
**Documentation** : Partie int√©grante de l'√©cosyst√®me UPlanet ·∫êEN
